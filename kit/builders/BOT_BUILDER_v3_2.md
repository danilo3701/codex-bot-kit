# BOT BUILDER ¬∑ v3.2 (Codex + Railway Edition)
(—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è ‚Äú–æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞‚Äù –¥–ª—è Telegram-–±–æ—Ç–æ–≤/–º–∏–Ω–∏-–ø—Ä–æ–µ–∫—Ç–æ–≤: modules-first, —ç–∫–æ–Ω–æ–º–Ω–æ –ø–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É, –±–µ–∑ –≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏–π, –±–µ–∑ —Ä—É—á–Ω—ã—Ö –ø–∞—Ç—á–µ–π; –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Codex)

## 0) –ó–∞—á–µ–º —ç—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç
–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –∑–∞–¥–∞—ë—Ç:
- ‚Äú–∫—É–ª—å—Ç—É—Ä—É‚Äù —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Å –ò–ò: –±–µ–∑ –≤—ã–¥—É–º–æ–∫, —Å –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏, —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
- –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É ‚Äú–º–∏–Ω–∏-–±–æ—Ç—ã –≤–Ω—É—Ç—Ä–∏ –±–æ—Ç–∞‚Äù (modules-first / feature-based)
- —Ä–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã: D (—Å–æ–∑–¥–∞—Ç—å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è) ‚Üí A (–¥–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å) ‚Üí C (Codex: –∏–∑–º–µ–Ω–∏—Ç—å –∫–æ–¥ + –ø—Ä–æ–≤–µ—Ä–∏—Ç—å)
- —Å—Ç–∞–Ω–¥–∞—Ä—Ç –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤: –∫–∞–∫–∏–µ —Ñ–∞–π–ª—ã –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –∏ —á—Ç–æ –≤ –Ω–∏—Ö –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å

–û—Å–Ω–æ–≤–∞–Ω–∏–µ: —Ç–≤–æ—è QA-–¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞ (anti-hallucination, flowcheck, –ª–∏–Ω–∑—ã, —á–µ–∫-–ª–∏—Å—Ç—ã) + modules-first –ø–æ–¥—Ö–æ–¥ + Codex workflow. ÓàÄfileciteÓàÇturn10file0ÓàÅ

---

## 1) PROJECT COMPASS (—Ü–µ–Ω–Ω–æ—Å—Ç–∏, —á—Ç–æ–±—ã –ò–ò –Ω–µ ‚Äú—É–µ–∑–∂–∞–ª‚Äù)
–¶–µ–ª—å: –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø—Ä–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ.

### –¶–µ–Ω–Ω–æ—Å—Ç–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
1) **–ú–æ–¥—É–ª—å —Å–∞–º–æ–¥–æ—Å—Ç–∞—Ç–æ—á–µ–Ω**: –∫–Ω–æ–ø–∫–∞ –º–µ–Ω—é = –º–∏–Ω–∏-–ø—Ä–æ–¥—É–∫—Ç (–º–∏–Ω–∏-–±–æ—Ç).
2) **–û–¥–∏–Ω –º–æ–¥—É–ª—å –∑–∞ —Ä–∞–∑**: –Ω–∏–∫–∞–∫–æ–≥–æ –ø—Ä—ã–∂–∫–∞ –ø–æ –ø—Ä–æ–µ–∫—Ç—É.
3) **–ù–µ –≤—ã–¥—É–º—ã–≤–∞—Ç—å**: –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç ‚Äî ‚Äú–ù–ï –í–ò–ñ–£ ‚Ä¶‚Äù –∏ –∑–∞–ø—Ä–æ—Å –º–∏–Ω–∏–º—É–º–∞.
4) **–ß–∏—Å—Ç—ã–π —á–∞—Ç**: –æ–¥–∏–Ω –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω —á–µ—Ä–µ–∑ edit; –≤–≤–æ–¥ —É–¥–∞–ª—è–µ–º; –æ—à–∏–±–∫–∏ —á–µ—Ä–µ–∑ alert (–µ—Å–ª–∏ —Ç–∞–∫ –ø—Ä–∏–Ω—è—Ç–æ).
5) **–ê–Ω—Ç–∏-–¥–æ–º–∏–Ω–æ**: –Ω–µ –ª–æ–º–∞–µ–º —Å–æ—Å–µ–¥–Ω–∏–µ –≤–µ—Ç–∫–∏, –Ω–µ –¥–µ–ª–∞–µ–º ‚Äú—Ä–µ—Ñ–∞–∫—Ç–æ—Ä —Ä–∞–¥–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∞‚Äù.

### Definition of Done (–∫–æ–≥–¥–∞ —Å—á–∏—Ç–∞–µ–º –º–æ–¥—É–ª—å/—Ñ–∏—á—É –≥–æ—Ç–æ–≤–æ–π)
- [ ] –ë–∞–∑–æ–≤—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç (end-to-end)
- [ ] –ö—Ä–∞–µ–≤—ã–µ —Å–ª—É—á–∞–∏ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã (–ø—É—Å—Ç–æ/–Ω–µ–≤–∞–ª–∏–¥–Ω–æ/–¥–≤–æ–π–Ω–æ–π –∫–ª–∏–∫/–Ω–∞–∑–∞–¥/–æ—Ç–º–µ–Ω–∞)
- [ ] –ù–µ—Ç ‚Äú–≤–µ—á–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏‚Äù (callback.answer() –≤–µ–∑–¥–µ)
- [ ] –ß–∏—Å—Ç—ã–π —á–∞—Ç —Å–æ–±–ª—é–¥—ë–Ω (edit + —É–¥–∞–ª–µ–Ω–∏–µ –≤–≤–æ–¥–∞ + alert)
- [ ] –ï—Å—Ç—å —Ç–µ—Å—Ç-—á–µ–∫–ª–∏—Å—Ç –º–æ–¥—É–ª—è (8‚Äì15 –ø—É–Ω–∫—Ç–æ–≤) –∏ –æ–Ω –ø—Ä–æ–π–¥–µ–Ω –≤—Ä—É—á–Ω—É—é
- [ ] –ü—Ä–æ–≥–Ω–∞–Ω `docs/health.md` (smoke + data + nohang)

---

## 2) –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞: MODULES-FIRST (–º–∏–Ω–∏-–±–æ—Ç—ã –≤–Ω—É—Ç—Ä–∏ –±–æ—Ç–∞)
### –ü—Ä–∏–Ω—Ü–∏–ø
–ù–µ ‚Äú—Å–ª–æ–∏‚Äù (handlers/services/storage), –∞ **–≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ —Å—Ä–µ–∑—ã –ø–æ —Ñ–∏—á–∞–º**.

- `bot/modules/<module_name>/` —Å–æ–¥–µ—Ä–∂–∏—Ç –í–°–Å, —á—Ç–æ –Ω—É–∂–Ω–æ –º–æ–¥—É–ª—é:
  handlers, keyboards, states, screens/texts, services, repo, errors, callbacks, rules, assets, contract.md, tests.md
- `bot/shared/` ‚Äî —Ç–æ–ª—å–∫–æ –º–∏–Ω–∏–º—É–º –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã (–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞, –æ–±—â–∏–µ –∫–Ω–æ–ø–∫–∏ ‚Äú–ú–µ–Ω—é/–ù–∞–∑–∞–¥‚Äù, –æ–±—â–∏–µ —Ç–∏–ø—ã –µ—Å–ª–∏ —Ä–µ–∞–ª—å–Ω–æ –Ω—É–∂–Ω–æ).
- –ï—Å–ª–∏ –æ–±—â–∞—è –ª–æ–≥–∏–∫–∞ –Ω—É–∂–Ω–∞ 2+ –º–æ–¥—É–ª—è–º: –≤—ã–Ω–æ—Å–∏–º –≤ shared **—Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —è–≤–Ω–æ–≥–æ —Å–æ–≥–ª–∞—Å–∏—è**.

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ (—à–∞–±–ª–æ–Ω)
bot/
  main.py                  # –∑–∞–ø—É—Å–∫ + register_modules()
  config.py                # —á—Ç–µ–Ω–∏–µ env

  shared/
    storage.py             # –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ/IO –∫ RailwayData (JSON)
    common_kb.py           # (–æ–ø—Ü.) –ú–µ–Ω—é/–ù–∞–∑–∞–¥
    utils.py               # (–æ–ø—Ü.) –º–µ–ª–∫–∏–µ —É—Ç–∏–ª–∏—Ç—ã

  modules/
    menu/
      router.py
      keyboards.py
      screens.py

    <module_name>/
      router.py
      keyboards.py
      screens.py
      callbacks.py
      contract.md
      tests.md
      states.py            # (–µ—Å–ª–∏ FSM)
      services.py          # (–µ—Å–ª–∏ –µ—Å—Ç—å –ª–æ–≥–∏–∫–∞)
      repo.py              # (–µ—Å–ª–∏ –µ—Å—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å storage)
      errors.py            # (–≤–∞–ª–∏–¥–∞—Ü–∏–∏/–æ—à–∏–±–∫–∏)
      rules.py             # (–æ—á–∫–∏/–ª–∏–º–∏—Ç—ã/–¥–µ–¥–ª–∞–π–Ω—ã)
      assets/              # (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

docs/
  requirements.md          # –æ–±—â–∏–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç –ø—Ä–æ–µ–∫—Ç–∞ (—Å—Ç–≤–æ–ª)
  runbook.md               # –∫–∞–∫ –∑–∞–ø—É—Å–∫–∞—Ç—å/–¥–µ–ø–ª–æ–∏—Ç—å/—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ (Railway)
  health.md                # –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —á–µ–∫–ª–∏—Å—Ç –∑–¥–æ—Ä–æ–≤—å—è
  data_contract.md         # –ø—Ä–∞–≤–∏–ª–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è/—Å—Ö–µ–º—ã –¥–∞–Ω–Ω—ã—Ö (JSON)
  security.md              # –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (ENV/–ª–æ–≥–∏/–æ—à–∏–±–∫–∏)
  glossary.md              # —Ç–µ—Ä–º–∏–Ω—ã (–Ω–æ—Ä–º–∞–ª—å–Ω—ã–π, 20‚Äì40)
  decisions.md             # (–æ–ø—Ü.) –∫–æ—Ä–æ—Ç–∫–∏–µ ‚Äú–ø–æ—á–µ–º—É —Ç–∞–∫ —Ä–µ—à–∏–ª–∏‚Äù

---

## 2.1 Standard Files (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –∏ —á—Ç–æ –≤ –Ω–∏—Ö –ø–∏—Å–∞—Ç—å)
–¶–µ–ª—å: —á—Ç–æ–±—ã –≤ –Ω–æ–≤–æ–º —á–∞—Ç–µ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –ù–ï –ø—Ä–æ–ø—É—Å–∫–∞–ª –≤–∞–∂–Ω—ã–µ —Ñ–∞–π–ª—ã –∏ –≤—Å–µ–≥–¥–∞ –∑–Ω–∞–ª, —á—Ç–æ –≤ –∫–∞–∂–¥–æ–º –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å.

### A) –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
1) `README.md` (–≤ –∫–æ—Ä–Ω–µ) ‚Äî ‚Äú–∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Ä–µ–ø–æ‚Äù
   - —á—Ç–æ –¥–µ–ª–∞–µ—Ç –±–æ—Ç (3‚Äì7 —Å—Ç—Ä–æ–∫)
   - quickstart (2‚Äì6 —à–∞–≥–æ–≤)
   - Railway –¥–µ–ø–ª–æ–π (ENV + —Å—Ç–∞—Ä—Ç-–∫–æ–º–∞–Ω–¥–∞)
   - —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ modules-first
   - ‚ÄúHow to add a module‚Äù (3‚Äì5 —à–∞–≥–æ–≤)

2) `.env.example`
   - –º–∏–Ω–∏–º—É–º: `BOT_TOKEN`, `DATA_PATH`
   - –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: `LOG_LEVEL`, `TZ`

3) `docs/requirements.md` (–∫–æ–Ω—Ç—Ä–∞–∫—Ç –ø—Ä–æ–µ–∫—Ç–∞, –æ–¥–∏–Ω –Ω–∞ –≤–µ—Å—å –±–æ—Ç)
   - —Ä–æ–ª–∏ –∏ –ø—Ä–∞–≤–∞ (–Ω–∞ —É—Ä–æ–≤–Ω–µ —Å–º—ã—Å–ª–∞)
   - –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é (—Å–ø–∏—Å–æ–∫ –º–æ–¥—É–ª–µ–π)
   - –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ UX (clean chat / nohang / —Ñ–æ—Ä–º–∞—Ç—ã)
   - –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –¥–∞–Ω–Ω—ã—Ö (—á—Ç–æ —Å—á–∏—Ç–∞–µ–º –æ–±—â–∏–º)
   - non-goals (—á—Ç–æ –Ω–µ –¥–µ–ª–∞–µ–º)
   - DoD –ø—Ä–æ–µ–∫—Ç–∞

4) `docs/runbook.md` (Railway + polling + volume)
   - –∫–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ
   - –∫–∞–∫ –∑–∞–¥–µ–ø–ª–æ–∏—Ç—å –Ω–∞ Railway
   - –≥–¥–µ —Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
   - ‚Äú–±–æ—Ç –º–æ–ª—á–∏—Ç‚Äù —á–µ–∫–ª–∏—Å—Ç
   - rollback

5) `docs/health.md` (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —á–µ–∫–ª–∏—Å—Ç)
   - process alive (Railway)
   - telegram connectivity (/start)
   - nohang (answer)
   - data read/write (volume json)
   - smoke –ø–æ 2‚Äì3 –º–æ–¥—É–ª—è–º

6) `docs/data_contract.md`
   - –ø—Ä–∏–Ω—Ü–∏–ø: user-centric –Ω–µ –¥—Ä–æ–±–∏–º –±–µ–∑ –Ω—É–∂–¥—ã
   - —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è —Å—Ö–µ–º–∞ —Ñ–∞–π–ª–æ–≤ (users.json / stats.json / subscriptions.json / system.json)
   - schema_version + –º–∏–≥—Ä–∞—Ü–∏–∏
   - atomic write + backup broken json

7) `docs/security.md`
   - —á—Ç–æ —Å—á–∏—Ç–∞–µ–º secret
   - –∑–∞–ø—Ä–µ—Ç —É—Ç–µ—á–µ–∫ –≤ –ª–æ–≥–∞—Ö
   - –ø–æ–ª–∏—Ç–∏–∫–∞ –æ—à–∏–±–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é vs –≤ –ª–æ–≥
   - –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è volume json (–Ω–µ —Ö—Ä–∞–Ω–∏—Ç—å —Å–µ–∫—Ä–µ—Ç—ã)

8) `docs/glossary.md`
   - —Ç–µ—Ä–º–∏–Ω—ã (20‚Äì40), –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ 2+ –º–æ–¥—É–ª—è—Ö

9) `docs/decisions.md` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
   - 1‚Äì3 —Å—Ç—Ä–æ–∫–∏ –Ω–∞ —Ä–µ—à–µ–Ω–∏–µ: storage, timezone, FSM, –ø–æ–¥–ø–∏—Å–∫–∞-–≥–µ–π—Ç –∏ —Ç.–ø.

### B) –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –∫–æ–¥–∞
1) `bot/main.py`
   - –∑–∞–ø—É—Å–∫ –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –º–æ–¥—É–ª–µ–π
   - —Ç–æ—á–∫–∏ –≤—Ö–æ–¥–∞: /start, –º–µ–Ω—é
2) `bot/config.py`
   - —á—Ç–µ–Ω–∏–µ env, –∫–æ–Ω—Ñ–∏–≥-–æ–±—ä–µ–∫—Ç
3) `bot/shared/storage.py`
   - IO –∫ JSON –≤ `DATA_PATH` (–±–µ–∑ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏)
4) `bot/modules/menu/*`
   - menu router + kb + screens

### C) –°—Ç–∞–Ω–¥–∞—Ä—Ç –∫–∞–∂–¥–æ–≥–æ –º–æ–¥—É–ª—è
–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –≤—Å–µ–≥–¥–∞:
- `router.py`, `keyboards.py`, `screens.py`, `callbacks.py`, `contract.md`, `tests.md`

–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏:
- `states.py`, `services.py`, `repo.py`, `errors.py`, `rules.py`, `assets/`

---

## 3) –ö–æ–Ω—Ç—Ä–∞–∫—Ç –º–æ–¥—É–ª—è (–µ–¥–∏–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏ –∫–æ–Ω—Ç—Ä–æ–ª—è)
–î–ª—è –ª—é–±–æ–≥–æ –º–æ–¥—É–ª—è –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –æ–±—è–∑–∞–Ω —Å–Ω–∞—á–∞–ª–∞ –Ω–∞–ø–∏—Å–∞—Ç—å:
1) –í—Ö–æ–¥—ã (–∫–Ω–æ–ø–∫–∏/–∫–æ–º–∞–Ω–¥—ã/callback prefix)
2) –≠–∫—Ä–∞–Ω—ã –∏ —à–∞–≥–∏ (1‚Äì8)
3) FSM states + –ø–µ—Ä–µ—Ö–æ–¥—ã (–µ—Å–ª–∏ –µ—Å—Ç—å)
4) –î–∞–Ω–Ω—ã–µ (—á—Ç–æ —á–∏—Ç–∞–µ–º/–ø–∏—à–µ–º, —Ñ–∞–π–ª—ã/–∫–ª—é—á–∏)
5) –í–∞–ª–∏–¥–∞—Ü–∏–∏ –∏ –æ—à–∏–±–∫–∏ (FormatGate)
6) Edge cases (3‚Äì10)
7) DoD –º–æ–¥—É–ª—è
8) –¢–µ—Å—Ç-—á–µ–∫–ª–∏—Å—Ç (8‚Äì15)

---

## 4) –ü—Ä–∞–≤–∏–ª–∞ ‚Äú–∞–Ω—Ç–∏-–≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏–∏‚Äù (–∂—ë—Å—Ç–∫–æ)
–ï—Å–ª–∏ –≤ –ø—Ä–∏—Å–ª–∞–Ω–Ω—ã—Ö —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ö –Ω–µ—Ç –Ω—É–∂–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏:
- –Ω–∞–ø–∏—Å–∞—Ç—å: `–ù–ï –í–ò–ñ–£ –í –§–ê–ô–õ–ê–•/–ö–û–î–ï: ...`
- –ø–æ–ø—Ä–æ—Å–∏—Ç—å –º–∏–Ω–∏–º—É–º: 1‚Äì2 —Ñ–∞–π–ª–∞ –ò–õ–ò 40‚Äì160 —Å—Ç—Ä–æ–∫ –≤–æ–∫—Ä—É–≥ –Ω—É–∂–Ω–æ–≥–æ –º–µ—Å—Ç–∞

–ó–∞–ø—Ä–µ—â–µ–Ω–æ:
- –ø—Ä–∏–¥—É–º—ã–≤–∞—Ç—å –∏–º–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏–π/–ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö/–∫–æ–Ω—Å—Ç–∞–Ω—Ç
- ‚Äú—Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ —É –≤–∞—Å –µ—Å—Ç—å ‚Ä¶‚Äù –±–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
- –ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –±–µ–∑ **—è–≤–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ —Ñ–∞–π–ª–æ–≤** –∏ ‚Äú—á—Ç–æ –º–µ–Ω—è—Ç—å –≤ –∫–∞–∂–¥–æ–º‚Äù

---

## 5) Confidence Gate (–∫–æ–≥–¥–∞ –º–æ–∂–Ω–æ –¥–∞–≤–∞—Ç—å –¥–µ–π—Å—Ç–≤–∏—è)
- ‚â•90% ‚Üí –º–æ–∂–Ω–æ –¥–∞–≤–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π plan / CODEX TASK
- 80‚Äì89% ‚Üí –≥–∏–ø–æ—Ç–µ–∑–∞ + –ø—Ä–æ–≤–µ—Ä–∫–∏ + 1 –≥–ª–∞–≤–Ω—ã–π –≤–æ–ø—Ä–æ—Å
- <80% ‚Üí —Å—Ç–æ–ø, –∑–∞–ø—Ä–æ—Å –º–∏–Ω–∏–º—É–º–∞ –¥–∞–Ω–Ω—ã—Ö

Stakes:
- Low/Medium ‚Üí 90%
- High ‚Üí 95%
- Critical ‚Üí 99%

---

## 6) –†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã (D / A / C)

### 6.1 Mode D ‚Äî ARCHITECT (—Å–æ–∑–¥–∞–Ω–∏–µ —Å –Ω—É–ª—è)
–ö–æ–≥–¥–∞: –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç –∏–ª–∏ –±–æ–ª—å—à–∞—è –Ω–æ–≤–∞—è –≤–µ—Ç–∫–∞.
–ü—Ä–∞–≤–∏–ª–∞:
- –∫–æ–¥ –Ω–µ –ø–∏—Å–∞—Ç—å –¥–æ —è—Å–Ω–æ—Å—Ç–∏ 95%+
- –≤–æ–ø—Ä–æ—Å—ã –±–∞—Ç—á–∞–º–∏ 1‚Äì3 (üî¥üü†üü°)
- –≤ –∫–æ–Ω—Ü–µ: –æ–¥–∏–Ω `docs/TASK.md` (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ –∏–º–µ–Ω–Ω–æ –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞/–≤–µ—Ç–∫–∏)

–í—ã—Ö–æ–¥:
- flows (–∫–∞—Ä—Ç–∞ –º–µ—Ç—Ä–æ)
- —Å—É—â–Ω–æ—Å—Ç–∏/–¥–∞–Ω–Ω—ã–µ
- UX –ø—Ä–∞–≤–∏–ª–∞
- —Ä–∏—Å–∫–∏ –¥–æ–º–∏–Ω–æ
- —Ç–µ—Å—Ç-—á–µ–∫–ª–∏—Å—Ç
- —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤/—Å–∫–µ–ª–µ—Ç

### 6.2 Mode A ‚Äî DIAGNOSTICIAN (–Ω–∞–π—Ç–∏ –ø—Ä–∏—á–∏–Ω—É –∏ —Å–æ–±—Ä–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ)
–ö–æ–≥–¥–∞: BUG/FEATURE/REFACTOR –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º –ø—Ä–æ–µ–∫—Ç–µ.
–í—ã—Ö–æ–¥ (—Å—Ç—Ä–æ–≥–æ):
0) –ü–æ–Ω–∏–º–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ (1‚Äì3 —Å—Ç—Ä–æ–∫–∏)
1) –¢–∏–ø –ø—Ä–æ–±–ª–µ–º—ã (1 —Å—Ç—Ä–æ–∫–∞)
2) FLOWCHECK (–≤—Ö–æ–¥ ‚Üí –¥–µ–π—Å—Ç–≤–∏—è ‚Üí –≤—ã—Ö–æ–¥)
2.1) LINK MAP (–µ—Å–ª–∏ 2+ —Ñ–∞–π–ª–∞/—É–∑–ª–∞)
3) –ú–æ–¥—É–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ (DupCheck/CleanChat/NoHang/FormatGate/NeighborImpact/StorageIO/PlanJudge/ParamLock)
4) DIAGNOSIS (1‚Äì3 –ø—Ä–∏—á–∏–Ω—ã + –∫–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å)
5) WHERE TO LOOK (—Ñ–∞–π–ª ‚Üí —Ö–µ–Ω–¥–ª–µ—Ä ‚Üí —á—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å)
6) FIX PLAN (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π)
7) CODEX TASK (–≥–æ—Ç–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è Codex)

### 6.3 Mode C ‚Äî CODEX EXECUTION + VERIFY
1) –ü–µ—Ä–µ–¥–∞—Ç—å Codex ‚ÄúCODEX TASK‚Äù
2) –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è ‚Äî –ø—Ä–æ–≥–Ω–∞—Ç—å PR-Check (—Ä–∞–∑–¥–µ–ª 7), `modules/<module>/tests.md` –∏ `docs/health.md`
3) –ï—Å–ª–∏ –Ω–µ —Ç–∞–∫ ‚Äî –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ Mode A –∏ –≤—ã–¥–∞—Ç—å –Ω–æ–≤—ã–π CODEX TASK

---

## 6.4 CODEX TASK TEMPLATE (—Å—Ç–∞–Ω–¥–∞—Ä—Ç –∑–∞–¥–∞–Ω–∏—è –¥–ª—è Codex)
**–¢–∏–ø:** BUG / FEATURE / REFACTOR / NEW MODULE  
**Stakes:** Low / Medium / High / Critical  
**–ú–æ–¥—É–ª—å:** `modules/<module_name>/`  
**–ö–æ–Ω—Ç–µ–∫—Å—Ç (1‚Äì3 —Å—Ç—Ä–æ–∫–∏):** ‚Ä¶

### 1) –ì—Ä–∞–Ω–∏—Ü—ã (–æ—á–µ–Ω—å –≤–∞–∂–Ω–æ)
**–†–∞–∑—Ä–µ—à–µ–Ω–æ –º–µ–Ω—è—Ç—å —Ç–æ–ª—å–∫–æ:**
- `bot/modules/<module_name>/**`
- `bot/main.py` (—Ç–æ–ª—å–∫–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –º–æ–¥—É–ª—è)
- `bot/shared/storage.py` (—Ç–æ–ª—å–∫–æ IO, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

**–ó–∞–ø—Ä–µ—â–µ–Ω–æ:**
- —Ç—Ä–æ–≥–∞—Ç—å –¥—Ä—É–≥–∏–µ –º–æ–¥—É–ª–∏
- –º–∞—Å—Å–æ–≤—ã–π —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ ‚Äú–∑–∞–æ–¥–Ω–æ‚Äù
- –º–µ–Ω—è—Ç—å —Ç–µ–∫—Å—Ç—ã/UX, –µ—Å–ª–∏ —è –Ω–µ —Ä–∞–∑—Ä–µ—à–∏–ª

### 2) –û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ (–∫–æ–Ω—Ç—Ä–∞–∫—Ç)
- –§–∞–∫—Ç —Å–µ–π—á–∞—Å:
- –û–∂–∏–¥–∞–Ω–∏–µ:
- Edge cases:
- –û—à–∏–±–∫–∏/–≤–∞–ª–∏–¥–∞—Ü–∏–∏:

### 3) Flow (–∫–∞—Ä—Ç–∞ –º–µ—Ç—Ä–æ)
1) –í—Ö–æ–¥:
2) ‚Ä¶
3) –í—ã—Ö–æ–¥:

### 4) –ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å (—Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á)
- [ ] ‚Ä¶
- [ ] ‚Ä¶

### 5) –§–∞–π–ª—ã, –∫–æ—Ç–æ—Ä—ã—Ö –∫–æ—Å–Ω—É—Ç—å—Å—è (—è–≤–Ω–æ)
- `router.py` ‚Äî ‚Ä¶
- `keyboards.py` ‚Äî ‚Ä¶
- `screens.py` ‚Äî ‚Ä¶
- `callbacks.py` ‚Äî ‚Ä¶
- (–æ–ø—Ü.) `states.py/services.py/repo.py/errors.py/rules.py` ‚Äî ‚Ä¶

### 6) Acceptance / DoD
- [ ] happy path
- [ ] edge cases
- [ ] nohang
- [ ] clean chat
- [ ] data read/write ok (–µ—Å–ª–∏ –µ—Å—Ç—å)
- [ ] tests.md –ø—Ä–æ–π–¥–µ–Ω
- [ ] health.md –ø—Ä–æ–≥–Ω–∞–Ω (smoke)

### 7) –ï—Å–ª–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç
–û—Å—Ç–∞–Ω–æ–≤–∏—Å—å –∏ –∑–∞–¥–∞–π –º–∞–∫—Å–∏–º—É–º 3 –≤–æ–ø—Ä–æ—Å–∞:
- `–ù–ï –•–í–ê–¢–ê–ï–¢: ...`
- —á—Ç–æ –ø—Ä–∏—Å–ª–∞—Ç—å (1‚Äì2 —Ñ–∞–π–ª–∞ –∏–ª–∏ 40‚Äì160 —Å—Ç—Ä–æ–∫)

---

## 7) PR-Check (–ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π Codex)
–§–æ—Ä–º–∞—Ç –≤—Å–µ–≥–¥–∞:
1) FLOWCHECK
2) 4 –õ–ò–ù–ó–´ (Logic / Data&State / Reliability / Alternatives)
3) –°–ò–ù–¢–ï–ó (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –ø—Ä–∞–≤–æ–∫ + –≥–¥–µ –∏—Å–∫–∞—Ç—å)
4) –¢–ï–°–¢-–ß–ï–ö–õ–ò–°–¢ (10‚Äì20) + –º–æ–¥—É–ª—å–Ω—ã–π tests.md

---

## 8) Context Pack (–∫–∞–∫ —ç–∫–æ–Ω–æ–º–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç)
–¢—ã –ø—Ä–∏—Å—ã–ª–∞–µ—à—å –æ–¥–Ω–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º:
- –¢–∏–ø: BUG / FEATURE / REFACTOR / NEW MODULE
- Stakes: Low/Medium/High/Critical
- –ú–æ–¥—É–ª—å: <module_name>
- –§–∞–∫—Ç/–û–∂–∏–¥–∞–Ω–∏–µ (1‚Äì3 —Å—Ç—Ä–æ–∫–∏)
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è: —á—Ç–æ –Ω–µ–ª—å–∑—è –º–µ–Ω—è—Ç—å (UX/—Ç–µ–∫—Å—Ç—ã/—Ñ–æ—Ä–º–∞—Ç—ã)
- –§—Ä–∞–≥–º–µ–Ω—Ç—ã (–µ—Å–ª–∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞): 40‚Äì160 —Å—Ç—Ä–æ–∫ –≤–æ–∫—Ä—É–≥:
  - router/handlers
  - keyboards
  - screens
  - storage IO (–µ—Å–ª–∏ —É—á–∞—Å—Ç–≤—É–µ—Ç)

–ï—Å–ª–∏ ‚Äú–Ω–µ –∑–Ω–∞—é –≥–¥–µ‚Äù ‚Äî –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –ø—Ä–æ—Å–∏—Ç 1‚Äì2 —Ñ–∞–π–ª–∞ –º–∏–Ω–∏–º—É–º.

---

## 9) Change Policy (—á—Ç–æ–±—ã –º–æ–¥—É–ª–∏ –Ω–µ —Ä–∞–∑—ä–µ–∑–∂–∞–ª–∏—Å—å)
- –ù–µ –ø—Ä–∞–≤–∏—Ç—å —Å–æ—Å–µ–¥–Ω–∏–µ –º–æ–¥—É–ª–∏ ‚Äú–∑–∞–æ–¥–Ω–æ‚Äù.
- –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –æ–±—â–µ–µ:
  - –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –ø–∏—à–µ—Ç: `–ù–£–ñ–ù–û –û–ë–©–ï–ï: <—á—Ç–æ> ‚Üí –ø—Ä–µ–¥–ª–∞–≥–∞—é bot/shared/<file>.py`
  - –∂–¥—ë—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è ‚Äú–¥–∞/–Ω–µ—Ç‚Äù.

---

## 10) Starter Prompt (–¥–ª—è –Ω–æ–≤–æ–≥–æ —á–∞—Ç–∞: modules-first + Codex)
(–∫–æ–ø–∏—Ä—É–π —Ü–µ–ª–∏–∫–æ–º –≤ –Ω–æ–≤—ã–π —á–∞—Ç)

–¢—ã ‚Äî BOT ARCHITECT + DIAGNOSTICIAN.
–ú—ã —Å—Ç—Ä–æ–∏–º Telegram-–±–æ—Ç –∫–∞–∫ MODULES (–º–∏–Ω–∏-–±–æ—Ç—ã –≤–Ω—É—Ç—Ä–∏ –±–æ—Ç–∞). –û–¥–∏–Ω –º–æ–¥—É–ª—å –∑–∞ —Ä–∞–∑.

–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:
- –ù–µ –≤—ã–¥—É–º—ã–≤–∞–π. –ï—Å–ª–∏ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –¥–∞–Ω–Ω—ã—Ö ‚Äî `–ù–ï –í–ò–ñ–£ ...` –∏ 1‚Äì3 –≤–æ–ø—Ä–æ—Å–∞.
- –†–∞–±–æ—Ç–∞–π —Ç–æ–ª—å–∫–æ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –æ–¥–Ω–æ–≥–æ –º–æ–¥—É–ª—è.
- –°–Ω–∞—á–∞–ª–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç/—á–µ–∫-–ª–∏—Å—Ç, –ø–æ—Ç–æ–º CODEX TASK.
- –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –æ–±—â–µ–µ ‚Äî –æ—Å—Ç–∞–Ω–æ–≤–∏—Å—å –∏ –ø—Ä–µ–¥–ª–æ–∂–∏ `–ù–£–ñ–ù–û –û–ë–©–ï–ï: ...`, –±–µ–∑ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π.
- –ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º: –ø–µ—Ä–µ—á–∏—Å–ª–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã (README, requirements, runbook, health, data_contract, security, glossary, contract/tests –º–æ–¥—É–ª—è) –∏ –ø—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –æ–Ω–∏ —É—á—Ç–µ–Ω—ã.

–°–Ω–∞—á–∞–ª–∞ –≤—ã–¥–∞–π:
1) –ö–æ–Ω—Ç—Ä–∞–∫—Ç –º–æ–¥—É–ª—è (–≤—Ö–æ–¥—ã ‚Üí —à–∞–≥–∏ ‚Üí —Å–æ—Å—Ç–æ—è–Ω–∏—è ‚Üí –¥–∞–Ω–Ω—ã–µ ‚Üí –æ—à–∏–±–∫–∏ ‚Üí edge cases)
2) –ü–ª–∞–Ω —Ñ–∞–π–ª–æ–≤ (—á—Ç–æ –≤ –∫–∞–∂–¥–æ–º)
3) –¢–µ—Å—Ç-—á–µ–∫–ª–∏—Å—Ç (8‚Äì15)
4) CODEX TASK (–ø–æ —à–∞–±–ª–æ–Ω—É –∏–∑ 6.4)

–ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç ‚Äî –º–∞–∫—Å–∏–º—É–º 3 –≤–æ–ø—Ä–æ—Å–∞ –∏ —Å—Ç–æ–ø.

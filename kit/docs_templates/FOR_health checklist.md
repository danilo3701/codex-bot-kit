# Health Checklist — <BOT_NAME>
Версия: v0.1  
Последнее обновление: <YYYY-MM-DD>  
Платформа: Railway · Режим: Polling · Данные: Volume JSON (`DATA_DIR`)

Цель: за 5–10 минут понять: **бот жив**, **основная логика не сломана**, **данные читаются/пишутся**, **нет типовых “зависаний”**.

---

## 0) Быстрый статус (1 минута)
- [ ] Railway Service **Running** (не в цикле рестартов)
- [ ] В логах есть “start” + “polling started” (или аналог)
- [ ] Нет свежих ERROR/Traceback сразу после старта

Если уже тут FAIL → см. `docs/runbook.md` раздел “бот молчит”.

---

## 1) Связь с Telegram (2 минуты)
- [ ] `/start` отвечает в течение 1–3 секунд
- [ ] Открывается главное меню (видны кнопки модулей)
- [ ] Нажатие любой inline-кнопки **не показывает вечную загрузку**
  - Признак проблемы: “часики”/spinner не пропадает → почти всегда забыли `answer()` в callback

---

## 2) Smoke по меню и навигации (2–3 минуты)
Выбери 2–3 модуля (лучше самый популярный + самый сложный):

Для каждого:
- [ ] Войти в модуль из меню
- [ ] Нажать “Назад” (если есть) → корректный предыдущий экран
- [ ] Нажать “Меню” → возврат в главное меню
- [ ] Повторно зайти в модуль → старт корректный, нет “старого мусора”

Признаки проблем:
- кнопки ведут не туда → конфликт callback prefix / неверная маршрутизация
- “иногда работает” → возможно дубль хендлеров/фильтров (DupCheck)

---

## 3) Data Health (Volume JSON) (2–3 минуты)
Проверяем минимум: **чтение**, **запись**, **целостность**.

### 3.1 Доступность volume
- [ ] `DATA_DIR` задан и существует (видно по логам или по поведению записи)
- [ ] При любом действии, которое должно сохранять данные, **файлы реально обновляются**

### 3.2 Чтение/запись
Выбери один сценарий, который пишет данные (настройка/создание/сохранение):
- [ ] Выполнить действие “сохранить”
- [ ] Проверить, что JSON-файл обновился (по времени изменения/по содержимому если смотришь)
- [ ] Перезапустить сервис (redeploy) и убедиться, что данные сохранились

### 3.3 Целостность JSON
Типовые симптомы битого JSON:
- бот падает при чтении
- модуль “ничего не показывает”, хотя данные должны быть
- в логах JSONDecodeError

Если это часто случается → в `docs/data_contract.md` фиксируем правило:
- “при ошибке чтения: сохранить backup файла и создать новый пустой”

---

## 4) Logic Health (главные правила) (3–5 минут)
Проверяем 3 типа логики:
- [ ] **Валидации формата** (FormatGate): неверный ввод → понятная ошибка + пример
- [ ] **Ограничения/правила** (если есть): лимиты/дедлайны/доступы применяются корректно
- [ ] **Консистентность**: UI не врёт данным (после сохранения видно то же самое)

Мини-сценарии:
- [ ] Невалидный ввод (буквы вместо числа/неверная дата) → ошибка, ничего не сохраняется
- [ ] Граничное значение min/max → корректно принимается
- [ ] Повтор действия → не создаёт дубликаты

---

## 5) Reliability Health (типовые “болячки”) (2–4 минуты)
- [ ] Callback не висит нигде (NoHang)
- [ ] Double click: дважды нажать одну кнопку → нет дублей/ошибок
- [ ] “Назад/Меню” из середины процесса → state/черновики не ломают следующий вход
- [ ] Ошибка I/O (если можно воспроизвести) → бот не падает молча, показывает понятный результат

---

## 6) Чистый чат (если это правило проекта) (2 минуты)
- [ ] Главный экран обновляется через edit (не спамит новыми сообщениями)
- [ ] Старые inline-кнопки не остаются “мертвыми”
- [ ] (Если принято) пользовательский ввод удаляется после обработки

---

## 7) Диагностика “что делать если FAIL” (коротко)
Выбери симптом → что проверять:

### 7.1 Бот не отвечает на /start
- проверить BOT_TOKEN
- проверить логи старта (падает до polling)
- проверить рестарты Railway

### 7.2 Кнопки “висят”
- искать callback handlers без `answer()`
- проверить порядок: answer должен быть первым или очень ранним

### 7.3 Иногда работает, иногда нет
- DupCheck: дубли prefix/state фильтров
- общий хендлер перекрывает частный

### 7.4 Данные “не сохранились”
- `DATA_DIR` не тот / нет прав на запись
- запись не вызывается (логика не дошла до save)
- JSON повреждён

---

## 8) Итог (1 строка)
- PASS / FAIL
- Если FAIL: 1–2 симптома + где смотреть (лог/модуль/данные)
- Следующий шаг: Mode A (DIAGNOSTICIAN) → сформировать CODEX TASK

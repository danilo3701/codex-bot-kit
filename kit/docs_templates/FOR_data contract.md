# Data Contract — <BOT_NAME> (RailwayData / Volume JSON)
??????: v0.1  
????????? ??????????: <YYYY-MM-DD>  
?????????: Railway Volume (RailwayData) · ??????: JSON files · ????: `DATA_DIR`

????: ?????? ??????? ???????? ??????, ????? ?????? ?? ?????? ???? ?????, ? Codex ?? “????????” ????????? ?? ???????? ??????.

---

## 1) ???????? ???????? (??????? ???????)
1) **User-centric ?????? ?? ?????? ??? ?????**  
   ???? ?????? ????????? ? ?????? ???????????? (?????????, ????????, ????), ?? ????????? ?????? ?? **? ????? ?????**, ????? ?? ???? 5 ?????? ?????? “??? ?????? ? ???? ?? ?????”.

2) **????????? ?? ??????????, ???? ??? ??????? ????????? ?????**
   ?????????? ?????????, ?????:
   - ?????? ?????? ????? ? ?????? ???????? ?????? (????????, “????” ??????? ?????, “?????????” ?????)
   - ?????? ????? ????? ????????????/????? ?? ??????
   - ?????? ???????/????? (????????, ????????/??????? ????????)

3) **????????? ?????? ???? ??????????**
   - ?????? ?????? ?????/??????? ??? “?????? ?????” ? ????????
   - ????? ???? ????????? ?????, ???????/??????????????? — ?????? ? ?????????

4) **?????? “?????? ?????”**
   ???? ???????? — ???? ???????? ??????.  
   ?????? ??????? “???????” ???????????? ? `users.json` ? ? `ratings.json`, ???? ??? ?????? ??????? ? ?????? ?????????????.

---

## 2) ????????????? ????? ?????? (?? ?????????)
??????????? “????????” ????? ??? ??????????? ?????:

### ??????? A (?? ?????????): 2–3 ?????
- `users.json` — **??? ??? ????????????** (??????? + ????????? + ????????, ???? ?? ????????)
- `system.json` — ????????? (?????? ?????, ?????, ????? ????????? ???????)
- `cache.json` (???????????) — ?????????, ????? ?????? ??? ????

### ??????? B (???? ?????? ?????/????? ???????): 3–5 ??????
- `users.json` — ??????? + ??????? ?????????
- `stats.json` — ????/????????/???????? (???? ??????? ??????)
- `subscriptions.json` — ???????? ?? ?????/??????? (???? ??? ????????? ????????? ??????)
- `system.json` — ?????? ????? ? ????????? ?????????
- `cache.json` — ????????? ??????

**??????? ??????:**  
???? ?? ???????????? — ??????? ? ???????? A. ???????? ?????, ????? ??????? ????? ??????.

---

## 3) ????? ????????? ?????? (???????? ??????)
### 3.1 users.json (????????????? ??????)
????: `user_id` (?????? ??? ????? — ??????? ? ?????????????)

?????? ?????????:
- `users[user_id]`:
  - `profile`: { `role`, `lang`, `tz`, `created_at` }
  - `settings`: { … }  (???????????, ????????? ?????????, ????????????)
  - `progress`: { … }  (???? ?????????: ?????????? ????/???????/???????)
  - `meta`: { `updated_at`, `schema_version` (???????????) }

### 3.2 stats.json (???? ????????)
- `stats[user_id]`:
  - `points`, `xp`, `level`
  - `history` (???? ?????) — ????? ???????????? ??????

### 3.3 subscriptions.json (???? ???? ????????)
- `subscriptions[user_id]`:
  - `channel_id` / `channel_username`
  - `status`: subscribed/unsubscribed/unknown
  - `checked_at`: timestamp

### 3.4 system.json
- `schema_version`: `1`
- `last_migration_at`
- `flags` (???????????)

---

## 4) ??????????????? ????? ? ????????
- ? `system.json` ???????? `schema_version`.
- ????? ????????? ???????:
  - ?????????? ????? — ?????? ?? ??? ????????
  - ??????????????/????????/????? ???? — ??????? ????????

????-??????? ????????:
- “??????? ???????????? ?????? + ?????”, ????? ?????? ?????? ? ????????? ??????.

---

## 5) ??????????? ? ?????? ?? ?????? JSON
????????????? ????????: JSON ????? ??????????? ??? ???? ??????.

????????????? ???????? ??????:
1) ?????? ?? ????????? ????: `<name>.tmp`
2) ???????????? JSON (???? ?? ??????? ????????)
3) ???????? ???????? ????: rename tmp ? json

???????? ??????:
- ???? JSONDecodeError:
  - ????????????? ???? ? `<name>.broken.<timestamp>.json`
  - ??????? ????? ?????? ????
  - ???????????? ??????

---

## 6) ?????????? ?????? (??? ?????? ?????? ???? ???????)
- `user_id` — ???? ?????? ?? ???? ?????? (?????? ??? int, ?? ??????)
- ???? ? ???????????? ???? `tz`, ?? ??????????? ??????? ?????????? ??
- ??? “?????????? ?????????” UI ????? ?????????? ?????????? ?? ?? ?????
- ???? ???? ????????-????, ?? ?????? ???????? ?? “?????????????” ??? ????????

---

## 7) ??????? ??????????????? ???????
- ?????? ?????? ????? ?????? “????” ????? ?????? ????????? ????????????
  - ??????: `users[user_id].settings.notifications`
  - ??????: `users[user_id].progress.podcast_module`
- ???? ?????? ????? ?????? ? “?????” ??????? — ??? ?????? ???? ???? ??????????? (????? ??????).

---

## 8) ????-??????? ????????? ?????? (????? Codex)
????? ?????? ???????????, ??????? ??????? storage:
- [ ] ??????????? ????? (users.json/stats.json/…)
- [ ] ??????????? ?????, ??????? ?????????/??????
- [ ] ??????? schema_version (????? ?? ??????)
- [ ] ??????? ????????? ???????? (???? ?????? ???/???)
- [ ] ???????? `modules/<module>/contract.md` (?????? “??????”)

# FOR_DOCS_MAP.md — Documentation Map & Update Policy (Universal Skeleton)
Версия: v1.0
Назначение: объяснить агентам/LLM, какие MD-файлы существуют, за что отвечают, и КОГДА их можно менять.
Принцип: modules-first + маленькие шаги (PLAN → BUILD → REVIEW/VERIFY).

---

## 0) Главный принцип (90% критично)
- Не делаем “всё в одном запросе”.
- На каждом шаге есть свой allowed scope (allowlist файлов).
- Если нужен файл вне allowlist — СТОП и 1–3 вопроса.

---

## 1) Карта документов (Doc Map)

### 1.1 Документы проекта (глобальные, /docs)
- `docs/requirements.md`
  Что это: “ствол” проекта — цель, роли, меню-модули, глобальные UX правила, non-goals, DoD.
  Когда менять: когда меняется смысл/политики, влияющие на 2+ модуля.

- `docs/runbook.md`
  Что это: эксплуатация/деплой/логи/“бот молчит”/rollback.
  Когда менять: когда меняется деплой, ENV, старт-команда, платформа, или добавились важные шаги диагностики.

- `docs/health.md` (или `docs/health_checklist.md`)
  Что это: smoke-чеклист “бот жив” (start/menu/module/back/nohang/data read/write).
  Когда менять: редко; только если появился новый критичный риск, который надо проверять всегда.

- `docs/glossary.md`
  Что это: словарь терминов/правил (nohang, clean chat, module, callback prefix и т.д.).
  Когда менять: когда вводим новые термины/правила в процессе разработки.

- `docs/security.md`
  Что это: базовая безопасность (секреты, логи, ошибки).
  Когда менять: если добавились токены/интеграции/хранилища/PII.

- `docs/data_contract.md`
  Что это: правила хранения данных (JSON/DB), версия схемы, миграции, safe write.
  Когда менять: если меняется формат хранения/схема/ключи данных.

> Примечание: названия могут отличаться в проекте. В конкретном проекте агент должен “привязать” их к реальным путям из repo tree.

### 1.2 Документы модулей (локальные, /modules или /bot/modules)
- `.../<module>/contract.md`
  Что это: контракт модуля (входы → шаги → данные → ошибки → edge cases → DoD модуля).
  Когда менять: на этапе PLAN, когда уточняем поведение модуля.

- `.../<module>/tests.md`
  Что это: ручной чеклист 8–15 пунктов, основанный на contract.
  Когда менять: можно дополнять, но по правилу append-only (см. ниже).

---

## 2) Политика тестов (append-only) 🧪
Файл `.../<module>/tests.md`:
- можно ТОЛЬКО добавлять новые тест-кейсы (append-only),
- нельзя удалять старые пункты,
- нельзя “переписывать структуру ради красоты”,
- если тест устарел — помечай как `DEPRECATED:` и добавь новый правильный.

Зачем: тесты должны становиться богаче и ловить регрессии, а не “скакать”.

---

## 3) Кто и когда меняет документы (PLAN → BUILD → REVIEW)

### 3.1 PLAN (документы/контракты, без кода)
Цель: договориться “что делаем” и “как проверяем”.
Разрешено менять:
- `docs/requirements.md` (если глобально)
- `docs/glossary.md` (если появились термины)
- `.../<module>/contract.md`
- `.../<module>/tests.md`
Запрещено:
- любые .py / реализация

Выход PLAN:
- обновлённый contract + tests (и при необходимости requirements)
- DoD/Acceptance сформулирован наблюдаемо

### 3.2 BUILD (реализация)
Цель: сделать, чтобы tests проходили.
Разрешено менять:
- код ТОЛЬКО в рамках allowlist задачи
- `.../<module>/tests.md` (только append-only, если надо добавить регрессию)
Запрещено:
- “подгонять” contract/requrements под сделанный код без явного запроса
- массовые рефакторы “на будущее”

Выход BUILD (обязателен):
- список Changed files
- self-check по DoD (галочки)
- manual run: 8–15 шагов (tests) + smoke (health)

### 3.3 REVIEW / VERIFY (проверка)
Цель: найти риски/регрессии и выдать следующий маленький фикс-наряд.
По умолчанию:
- код НЕ меняем, только отчёт
Если нужен hotfix:
- разрешить 1–3 конкретных файла (явный allowlist)

---

## 4) Минимальный набор файлов нового проекта (baseline)
Это “скелет”, который обычно генерится из FOR-шаблонов:
- `README.md` (quickstart + структура modules-first)
- `.env.example` (BOT_TOKEN + DATA_PATH/ DATA_DIR)
- `docs/requirements.md`
- `docs/runbook.md`
- `docs/health.md` (или health_checklist)
- `docs/glossary.md`
- `docs/security.md`
- `docs/data_contract.md`
- `.../<module>/contract.md`
- `.../<module>/tests.md`

---

## 5) Правило “не выдумывать” (anti-hallucination)
Если в контексте нет:
- repo tree,
- путей modules/docs,
- названий файлов,
агент обязан написать:
`НЕ ХВАТАЕТ: ...` и задать до 3 вопросов.

---

## 6) Как использовать этот файл (инструкция для агента)
Если ты агент:
1) Прочитай repo tree и выясни реальные пути `docs/` и `modules/`.
2) Привяжи Doc Map к реальным путям (не выдумывай).
3) На каждый шаг работы сформируй allowlist файлов по политике выше.
4) На BUILD обязательно выдай self-check и manual run.
